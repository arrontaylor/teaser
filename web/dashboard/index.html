<html>
	<head>
	    <script src="//code.jquery.com/jquery-1.12.0.min.js"></script>
		<style>
			body {
				margin: 0px;
				background: #eee;
			}
			div#main {
				width: 1000px;
				margin: 0px auto;
			}
			div#leftContainer {
				margin: 0px auto;
				width: 400px;
				height: 100%;
				border: 1px solid #d3c6c6;
				border-top:0px;
				background: #fff;
				float: left;
			}
			div#leftContainer input, button {
				margin: 0px auto;
				margin-top: 5px;
				padding: 5px;
				display: block;
				border-radius: 3px;
				border: 1px solid #ccc;
				outline: none;
			}
			div#leftContainer input:hover {
				border: 1px solid #333;
			}

			div#rightContainer {
				margin: 0px auto;
				width: 597px;
				border: 1px solid #d3c6c6;
				float: right;
				border-top:0px;
				border-left: 0px;
			}
			div#rightContainer span#header {
				text-align: center;
				display: block;
				padding-bottom: 5px;
				font-size: 14px;
				font-family: tahoma;
				border-bottom: 1px solid #ccc;
			}
			div#rightContainer input, button, select {
				margin: 0px auto;
				margin-top: 5px;
				padding: 5px;
				border-radius: 3px;
				border: 1px solid #ccc;
				outline: none;

			}
			div#rightContainer input:hover {
				border: 1px solid #333;
			}			
			table#teases {
				margin: 0px auto;
				width: 100%;
				overflow: scroll;
				background: #fff;
				font-size: 12px;
				font-family: verdana;
			}
			table#teases tr {
				text-align: center;
			}
			table#teases tr:nth-child(even) 
			{
				background-color: #eee;
			}
			table#recievedTeases td img {
				height: 25px;
				width: 25px;
			}
			div.header {
				padding: 15px;
				background: #eadede;
				font-size: 14px;
				font-family: tahoma;
				border-bottom: 1px solid #ccc;

			}
			div.newTease {
				padding: 25px 15px 15px 15px;
				text-align: center;
			}
			div.newTease span {
				font-size: 14px;
				font-family: tahoma;
			}
			div.newTease button {
				padding: 5px 10px 5px 10px;
				border: 1px solid #827a7a;
				color: #fff;
				cursor: pointer;
				border-radius: 5px;
				background: #b57575;
			}
				div.newTease button:hover {
				
				background: #d18787;
			}
			button.logout {
				padding: 5px 10px 5px 10px;
				border: 1px solid #d3c6c6;
				color: #fff;
				cursor: pointer;
				background: #b57575;
			}
			form {
				height: 15px;
			}
		</style>
	</head>
	<body>

		<script>
			$(function() {
				refreshProfile()
			});

			sendTease = function(tousername) {
				$.ajax('/create-tease.go').done(function() {
					reloadProfile()
				})
			}

			refreshProfile = function() {
				$.getJSON('/profile.json', function(data) {
					reloadProfile(data)
				});
			}

			reloadProfile = function(data) {
				// Remove all teases and 

				$('#recievedTeases')[0].innerHTML = ""
				$("#send-tease-select")[0].innerHTML = ""

				$('#username')[0].innerHTML = data.username

				$.each(data.friends, function(index, friend) {
					$("#send-tease-select").append($("<option value=\"" + friend + "\">" + friend + "</option>"))
				})
				$.each(data.teases, function(index, tease) {
					var row = $("<tr><td><img src=\"../tease.png\"></td><form><td name=tousername>" + tease.FromUsername + "</td><td>" + tease.Time + "</td><td><button value=sendback  onclick=sendTease() >sendback</button></form></td></tr>")
					$('button', row).click(function() {
						replyTease(tease.FromUsername)
					})
					$("#recievedTeases").append(row)
				})
			}

			sendTease = function() {
				var value = $('#send-tease-select')[0].value
				
				var fd = new FormData();    
				fd.append( 'tousername', value );

				$.ajax({
				  url: '/create-tease.go',
				  data: fd,
				  processData: false,
				  contentType: false,
				  type: 'POST',
				  success: function(data){
				  	refreshProfile()
			  	  },
			  	  error: function() {
			  	  	console.log('oops')
			  	  	console.log(arguments)
			  	  }
			  	});	
			}
			replyTease = function(fromusername) {
				var fd = new FormData();    
				fd.append( 'tousername', fromusername );
				$.ajax({
				  url: '/create-tease.go',
				  data: fd,
				  processData: false,
				  contentType: false,
				  type: 'POST',
				  success: function(data){
				  	refreshProfile()
			  	  },
			  	  error: function() {
			  	  	console.log('oops')
			  	  	console.log(arguments)
			  	  }
			  	});	
			}
		</script>

		<div id="main">
			<div id="leftContainer">
				<div class="header">
					<span>
						<span id="username"></span> Tease a Friend
					</span>
				</div>
				<div class="newTease">
					<span>
						Choose your tease:
					</span>
					<select name="tousername" id="send-tease-select" type="text" placeholder="username">
					</select><br><br>
					<button type="submit" onclick="sendTease()">Submit</button>
				</div>
				
				<br><br>
				<button>
					Log out
				</button>
			</div>
			<div id="rightContainer">
				<div class="header">
					<span>
						Recent Teases
					</span>
				</div>
				<table id="recievedTeases">
					
				</table>
			</div>
		</div>
	</body>
</html>